x-env-files: &env_files
  - path: ./../../.env.dev
    required: true
  - path: ./../../.env.shared
    required: true
  - path: ./../../.env.local
    required: false
  - path: ./../../.env
    required: false

services:
  bismillahdao-migrate:
    build:
      dockerfile: ./docker/images/Dockerfile.migrate-dev
      context: ./../../../
    container_name: bismillahdao-migrate
    dns:
      - 8.8.8.8
      - 8.8.4.4
    volumes:
      - muhafidh_cargo_cache:/usr/local/cargo/registry
      - muhafidh_sccache:/sccache
      - muhafidh_target_cache:/app/muhafidh/target
    restart: unless-stopped
    env_file: *env_files
    networks:
      - bismillahdao_net

volumes:
  muhafidh_cargo_cache:
  muhafidh_target_cache:
  muhafidh_sccache: